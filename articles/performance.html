<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="R7">
<title>Performance â€¢ R7</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Performance">
<meta property="og:description" content="R7">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">R7</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/R7.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/dispatch.html">R7 generics and method dispatch</a>
    <a class="dropdown-item" href="../articles/compatibility.html">Compatibility</a>
    <a class="dropdown-item" href="../articles/performance.html">Performance</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../articles/index.html">More articles...</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/RConsortium/OOP-WG/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Performance</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/RConsortium/OOP-WG/blob/HEAD/vignettes/performance.Rmd" class="external-link"><code>vignettes/performance.Rmd</code></a></small>
      <div class="d-none name"><code>performance.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://RConsortium.github.io/OOP-WG">R7</a></span><span class="op">)</span></span></code></pre></div>
<p>The dispatch performance should be roughly on par with S3 and S4, though as this is implemented in a package there is some overhead due to <code>.Call</code> vs <code>.Primitive</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">text</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_class.html">new_class</a></span><span class="op">(</span><span class="st">"text"</span>, parent <span class="op">=</span> <span class="va">class_character</span><span class="op">)</span></span>
<span><span class="va">number</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_class.html">new_class</a></span><span class="op">(</span><span class="st">"number"</span>, parent <span class="op">=</span> <span class="va">class_double</span><span class="op">)</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span><span class="st">"hi"</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">number</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">foo_R7</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_generic.html">new_generic</a></span><span class="op">(</span><span class="st">"foo_R7"</span>, <span class="st">"x"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/method.html">method</a></span><span class="op">(</span><span class="va">foo_R7</span>, <span class="va">text</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"-foo"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">foo_S3</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/UseMethod.html" class="external-link">UseMethod</a></span><span class="op">(</span><span class="st">"foo_S3"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">foo_S3.text</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"-foo"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">methods</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/methods/setOldClass.html" class="external-link">setOldClass</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"number"</span>, <span class="st">"numeric"</span>, <span class="st">"R7_object"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/methods/setOldClass.html" class="external-link">setOldClass</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"text"</span>, <span class="st">"character"</span>, <span class="st">"R7_object"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/methods/setGeneric.html" class="external-link">setGeneric</a></span><span class="op">(</span><span class="st">"foo_S4"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/standardGeneric.html" class="external-link">standardGeneric</a></span><span class="op">(</span><span class="st">"foo_S4"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "foo_S4"</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"foo_S4"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"text"</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"-foo"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Measure performance of single dispatch</span></span>
<span><span class="fu">bench</span><span class="fu">::</span><span class="fu"><a href="http://bench.r-lib.org/reference/mark.html" class="external-link">mark</a></span><span class="op">(</span><span class="fu">foo_R7</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="fu">foo_S3</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="fu">foo_S4</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 Ã— 6</span></span></span>
<span><span class="co">#&gt;   expression      min   median `itr/sec` mem_alloc `gc/sec`</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;bch:expr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;bch:tm&gt;</span> <span style="color: #949494; font-style: italic;">&lt;bch:tm&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;bch:byt&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> foo_R7(x)     8.4Âµs    9.6Âµs    <span style="text-decoration: underline;">83</span>857.    16.6KB     25.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> foo_S3(x)     2.9Âµs    3.2Âµs   <span style="text-decoration: underline;">281</span>203.        0B     28.1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> foo_S4(x)     3.4Âµs    3.8Âµs   <span style="text-decoration: underline;">249</span>135.        0B      0</span></span>
<span></span>
<span><span class="va">bar_R7</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_generic.html">new_generic</a></span><span class="op">(</span><span class="st">"bar_R7"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/method.html">method</a></span><span class="op">(</span><span class="va">bar_R7</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">text</span>, <span class="va">number</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">...</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"-"</span>, <span class="va">y</span>, <span class="st">"-bar"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/methods/setGeneric.html" class="external-link">setGeneric</a></span><span class="op">(</span><span class="st">"bar_S4"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">...</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/standardGeneric.html" class="external-link">standardGeneric</a></span><span class="op">(</span><span class="st">"bar_S4"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "bar_S4"</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"bar_S4"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"text"</span>, <span class="st">"number"</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">...</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"-"</span>, <span class="va">y</span>, <span class="st">"-bar"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Measure performance of double dispatch</span></span>
<span><span class="fu">bench</span><span class="fu">::</span><span class="fu"><a href="http://bench.r-lib.org/reference/mark.html" class="external-link">mark</a></span><span class="op">(</span><span class="fu">bar_R7</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span>, <span class="fu">bar_S4</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 Ã— 6</span></span></span>
<span><span class="co">#&gt;   expression        min   median `itr/sec` mem_alloc `gc/sec`</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;bch:expr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;bch:tm&gt;</span> <span style="color: #949494; font-style: italic;">&lt;bch:tm&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;bch:byt&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> bar_R7(x, y)   16.1Âµs   17.8Âµs    <span style="text-decoration: underline;">55</span>291.        0B     22.1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> bar_S4(x, y)    9.7Âµs   10.4Âµs    <span style="text-decoration: underline;">93</span>666.        0B     18.7</span></span></code></pre></div>
<p>A potential optimization is caching based on the class names, but lookup should be fast without this.</p>
<p>The following benchmark generates a class hierarchy of different levels and lengths of class names and compares the time to dispatch on the first class in the hiearchy vs the time to dispatch on the last class.</p>
<p>We find that even in very extreme cases (e.g.Â 100 deep heirachy 100 of character class names) the overhead is reasonable, and for more reasonable cases (e.g.Â 10 deep hiearchy of 15 character class names) the overhead is basically negligible.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://RConsortium.github.io/OOP-WG">R7</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">gen_character</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">n</span>, <span class="va">min</span> <span class="op">=</span> <span class="fl">5</span>, <span class="va">max</span> <span class="op">=</span> <span class="fl">25</span>, <span class="va">values</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">letters</span>, <span class="va">LETTERS</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">9</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">lengths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">min</span><span class="op">:</span><span class="va">max</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, size <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span>
<span>  <span class="va">values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">values</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">lengths</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="va">starts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">lengths</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="va">n</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">ends</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">lengths</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/mapply.html" class="external-link">mapply</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">start</span>, <span class="va">end</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">values</span><span class="op">[</span><span class="va">start</span><span class="op">:</span><span class="va">end</span><span class="op">]</span>, collapse<span class="op">=</span><span class="st">""</span><span class="op">)</span>, <span class="va">starts</span>, <span class="va">ends</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">bench</span><span class="fu">::</span><span class="fu"><a href="http://bench.r-lib.org/reference/press.html" class="external-link">press</a></span><span class="op">(</span></span>
<span>  num_classes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">50</span>, <span class="fl">100</span><span class="op">)</span>,</span>
<span>  class_nchar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">15</span>, <span class="fl">100</span><span class="op">)</span>,</span>
<span>  <span class="op">{</span></span>
<span>    <span class="co"># Construct a class hierarchy with that number of classes</span></span>
<span>    <span class="va">text</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_class.html">new_class</a></span><span class="op">(</span><span class="st">"text"</span>, parent <span class="op">=</span> <span class="va">class_character</span><span class="op">)</span></span>
<span>    <span class="va">parent</span> <span class="op">&lt;-</span> <span class="va">text</span></span>
<span>    <span class="va">classes</span> <span class="op">&lt;-</span> <span class="fu">gen_character</span><span class="op">(</span><span class="va">num_classes</span>, min <span class="op">=</span> <span class="va">class_nchar</span>, max <span class="op">=</span> <span class="va">class_nchar</span><span class="op">)</span></span>
<span>    <span class="va">env</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">new.env</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">x</span> <span class="kw">in</span> <span class="va">classes</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/assign.html" class="external-link">assign</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="../reference/new_class.html">new_class</a></span><span class="op">(</span><span class="va">x</span>, parent <span class="op">=</span> <span class="va">parent</span><span class="op">)</span>, <span class="va">env</span><span class="op">)</span></span>
<span>      <span class="va">parent</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">env</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span>    <span class="co"># Get the last defined class</span></span>
<span>    <span class="va">cls</span> <span class="op">&lt;-</span> <span class="va">parent</span></span>
<span></span>
<span>    <span class="co"># Construct an object of that class</span></span>
<span>    <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">cls</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"hi"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># Define a generic and a method for the last class (best case scenario)</span></span>
<span>    <span class="va">foo_R7</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_generic.html">new_generic</a></span><span class="op">(</span><span class="st">"foo_R7"</span>, <span class="st">"x"</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="../reference/method.html">method</a></span><span class="op">(</span><span class="va">foo_R7</span>, <span class="va">cls</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"-foo"</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># Define a generic and a method for the first class (worst case scenario)</span></span>
<span>    <span class="va">foo2_R7</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_generic.html">new_generic</a></span><span class="op">(</span><span class="st">"foo2_R7"</span>, <span class="st">"x"</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="../reference/method.html">method</a></span><span class="op">(</span><span class="va">foo2_R7</span>, <span class="va">R7_object</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"-foo"</span><span class="op">)</span></span>
<span></span>
<span>    <span class="fu">bench</span><span class="fu">::</span><span class="fu"><a href="http://bench.r-lib.org/reference/mark.html" class="external-link">mark</a></span><span class="op">(</span></span>
<span>      best <span class="op">=</span> <span class="fu">foo_R7</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>      worst <span class="op">=</span> <span class="fu">foo2_R7</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 20 Ã— 8</span></span></span>
<span><span class="co">#&gt;    expression num_classes class_nchar      min   median `itr/sec` mem_alloc `gc/sec`</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;bch:expr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;bch:tm&gt;</span> <span style="color: #949494; font-style: italic;">&lt;bch:tm&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;bch:byt&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> best                 3          15    8.4Âµs    9.8Âµs   <span style="text-decoration: underline;">100</span>498.        0B     30.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> worst                3          15    8.7Âµs   10.1Âµs    <span style="text-decoration: underline;">97</span>422.        0B     29.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> best                 5          15    8.4Âµs    9.8Âµs   <span style="text-decoration: underline;">100</span>107.        0B     30.0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> worst                5          15    8.8Âµs   10.1Âµs    <span style="text-decoration: underline;">96</span>913.        0B     29.1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> best                10          15    8.5Âµs    9.8Âµs    <span style="text-decoration: underline;">99</span>805.        0B     20.0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> worst               10          15      9Âµs   10.3Âµs    <span style="text-decoration: underline;">94</span>981.        0B     28.5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> best                50          15    9.2Âµs   10.5Âµs    <span style="text-decoration: underline;">91</span>368.        0B     27.4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> worst               50          15   11.6Âµs     13Âµs    <span style="text-decoration: underline;">74</span>660.        0B     22.4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> best               100          15    9.9Âµs   11.2Âµs    <span style="text-decoration: underline;">87</span>205.        0B     34.9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> worst              100          15     15Âµs   16.4Âµs    <span style="text-decoration: underline;">59</span>846.        0B     18.0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> best                 3         100    8.5Âµs    9.9Âµs    <span style="text-decoration: underline;">97</span>372.        0B     29.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> worst                3         100      9Âµs   10.3Âµs    <span style="text-decoration: underline;">94</span>764.        0B     28.4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> best                 5         100    8.6Âµs    9.9Âµs    <span style="text-decoration: underline;">98</span>198.        0B     29.5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span> worst                5         100    9.2Âµs   10.5Âµs    <span style="text-decoration: underline;">92</span>817.        0B     27.9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span> best                10         100    8.5Âµs    9.8Âµs    <span style="text-decoration: underline;">99</span>375.        0B     29.8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span> worst               10         100     10Âµs   11.3Âµs    <span style="text-decoration: underline;">86</span>423.        0B     25.9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">17</span> best                50         100    9.2Âµs   10.5Âµs    <span style="text-decoration: underline;">92</span>877.        0B     27.9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">18</span> worst               50         100     15Âµs   16.4Âµs    <span style="text-decoration: underline;">59</span>983.        0B     18.0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">19</span> best               100         100     10Âµs   11.2Âµs    <span style="text-decoration: underline;">87</span>416.        0B     26.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">20</span> worst              100         100   22.2Âµs   22.8Âµs    <span style="text-decoration: underline;">43</span>377.        0B     13.0</span></span></code></pre></div>
<p>And the same benchmark using double-dispatch</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">bench</span><span class="fu">::</span><span class="fu"><a href="http://bench.r-lib.org/reference/press.html" class="external-link">press</a></span><span class="op">(</span></span>
<span>  num_classes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">50</span>, <span class="fl">100</span><span class="op">)</span>,</span>
<span>  class_nchar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">15</span>, <span class="fl">100</span><span class="op">)</span>,</span>
<span>  <span class="op">{</span></span>
<span>    <span class="co"># Construct a class hierarchy with that number of classes</span></span>
<span>    <span class="va">text</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_class.html">new_class</a></span><span class="op">(</span><span class="st">"text"</span>, parent <span class="op">=</span> <span class="va">class_character</span><span class="op">)</span></span>
<span>    <span class="va">parent</span> <span class="op">&lt;-</span> <span class="va">text</span></span>
<span>    <span class="va">classes</span> <span class="op">&lt;-</span> <span class="fu">gen_character</span><span class="op">(</span><span class="va">num_classes</span>, min <span class="op">=</span> <span class="va">class_nchar</span>, max <span class="op">=</span> <span class="va">class_nchar</span><span class="op">)</span></span>
<span>    <span class="va">env</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">new.env</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">x</span> <span class="kw">in</span> <span class="va">classes</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/assign.html" class="external-link">assign</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="../reference/new_class.html">new_class</a></span><span class="op">(</span><span class="va">x</span>, parent <span class="op">=</span> <span class="va">parent</span><span class="op">)</span>, <span class="va">env</span><span class="op">)</span></span>
<span>      <span class="va">parent</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">env</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span>    <span class="co"># Get the last defined class</span></span>
<span>    <span class="va">cls</span> <span class="op">&lt;-</span> <span class="va">parent</span></span>
<span></span>
<span>    <span class="co"># Construct an object of that class</span></span>
<span>    <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">cls</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"hi"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">cls</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"ho"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># Define a generic and a method for the last class (best case scenario)</span></span>
<span>    <span class="va">foo_R7</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_generic.html">new_generic</a></span><span class="op">(</span><span class="st">"foo_R7"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="../reference/method.html">method</a></span><span class="op">(</span><span class="va">foo_R7</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">cls</span>, <span class="va">cls</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">...</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="st">"-foo"</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># Define a generic and a method for the first class (worst case scenario)</span></span>
<span>    <span class="va">foo2_R7</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_generic.html">new_generic</a></span><span class="op">(</span><span class="st">"foo2_R7"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="../reference/method.html">method</a></span><span class="op">(</span><span class="va">foo2_R7</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">R7_object</span>, <span class="va">R7_object</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">...</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="st">"-foo"</span><span class="op">)</span></span>
<span></span>
<span>    <span class="fu">bench</span><span class="fu">::</span><span class="fu"><a href="http://bench.r-lib.org/reference/mark.html" class="external-link">mark</a></span><span class="op">(</span></span>
<span>      best <span class="op">=</span> <span class="fu">foo_R7</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span>,</span>
<span>      worst <span class="op">=</span> <span class="fu">foo2_R7</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 20 Ã— 8</span></span></span>
<span><span class="co">#&gt;    expression num_classes class_nchar      min   median `itr/sec` mem_alloc `gc/sec`</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;bch:expr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;bch:tm&gt;</span> <span style="color: #949494; font-style: italic;">&lt;bch:tm&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;bch:byt&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> best                 3          15   10.2Âµs   10.7Âµs    <span style="text-decoration: underline;">92</span>159.        0B    27.7 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> worst                3          15   10.7Âµs   11.2Âµs    <span style="text-decoration: underline;">87</span>805.        0B    35.1 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> best                 5          15   10.3Âµs   10.8Âµs    <span style="text-decoration: underline;">91</span>303.        0B    36.5 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> worst                5          15   10.9Âµs   11.4Âµs    <span style="text-decoration: underline;">86</span>675.        0B    26.0 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> best                10          15   10.5Âµs     11Âµs    <span style="text-decoration: underline;">88</span>370.        0B    26.5 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> worst               10          15   11.5Âµs   12.2Âµs    <span style="text-decoration: underline;">79</span>724.        0B    31.9 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> best                50          15   11.7Âµs   12.5Âµs    <span style="text-decoration: underline;">78</span>457.        0B    31.4 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> worst               50          15   16.3Âµs   17.1Âµs    <span style="text-decoration: underline;">57</span>467.        0B    23.0 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> best               100          15   13.3Âµs   14.1Âµs    <span style="text-decoration: underline;">68</span>678.        0B    27.5 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> worst              100          15   23.1Âµs   24.1Âµs    <span style="text-decoration: underline;">40</span>794.        0B    16.3 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> best                 3         100   10.3Âµs   11.1Âµs    <span style="text-decoration: underline;">86</span>749.        0B    34.7 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> worst                3         100   10.8Âµs   11.6Âµs    <span style="text-decoration: underline;">82</span>695.        0B    33.1 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> best                 5         100   10.5Âµs   11.3Âµs    <span style="text-decoration: underline;">85</span>594.        0B    34.3 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span> worst                5         100   11.2Âµs     12Âµs    <span style="text-decoration: underline;">79</span>973.        0B    32.0 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span> best                10         100   10.8Âµs   11.6Âµs    <span style="text-decoration: underline;">82</span>777.        0B    33.1 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span> worst               10         100   12.2Âµs   13.1Âµs    <span style="text-decoration: underline;">73</span>527.        0B    29.4 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">17</span> best                50         100     12Âµs   12.9Âµs    <span style="text-decoration: underline;">74</span>969.        0B    37.5 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">18</span> worst               50         100   23.3Âµs   24.3Âµs    <span style="text-decoration: underline;">40</span>232.        0B    16.1 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">19</span> best               100         100   13.3Âµs   14.2Âµs    <span style="text-decoration: underline;">67</span>428.        0B    20.2 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">20</span> worst              100         100   38.7Âµs   39.6Âµs    <span style="text-decoration: underline;">25</span>005.        0B     5.00</span></span></code></pre></div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Henrik Bengtsson, Will Landau, Michael Lawrence, Martin Maechler, Luke Tierney, Gabriela De Queiroz, Hadley Wickham, Jim Hester.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
